% !TEX root = clcl3.tex
\section{Stable definable functions}
\def\medrel#1{\parbox{5ex}{\hfil $#1$}}
\def\ceq#1#2#3{\parbox[t]{28ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

In this section we specialize the notions introduced in the previous sections to types $\sigma(x\,;z\,;X)$ of the form $\tau(x\,;z)\in X$, where $\tau(x\,;z)$ is an $S$-valued ${\EuScript F}$-type-definable function.

We say that $\tau(x\,;z)$ is \emph{stable\/} or \emph{$\varepsilon$-stable\/} if so is the type $\tau(x\,;z)\in X$.
The following fact is an interesting characterization of stability for functions which was first remarked in~\cite{B}.

\begin{fact}\label{fact_grothendieck}
  Let $S$ be a compact metric space.
  Let $\tau(x\,;z)$ be a term in ${\EuScript L}$.
  Then the following are equivalent
  \begin{itemize}
    \item [1.] the formula $\tau(x\,;z)\in X$ is unstable
    \item [2.] there is a sequence $\langle a_i\,;b_i\ :\ i<\omega\rangle$ such that the two limits below exist and\smallskip
    
    \noindent\kern-\labelwidth\kern-\labelsep
    \ceq{\hfill \lim_{i\to\infty}\lim_{j\to\infty}\tau(a_i\,;b_j)}{\neq}{\lim_{j\to\infty}\lim_{i\to\infty}\tau(a_i\,;b_j).}
  \end{itemize}
\end{fact}  
  Terms are a specific kind of definable functions.
  When $\tau(x\,;z)$ is a term, we have that ${\sim}\big(\tau(x\,;z)\in X\big)=\tau(x\,;z)\in X$, which is used throughout the proof below.
  We suspect that Fact~\ref{fact_grothendieck} holds more generally when $\tau(x\,;z)$ is an $S$-valued ${\EuScript F}$-type-definable function, but we have not been able to prove this.

  % \noindent\llap{\textcolor{red}{\Large\warning}\kern1.5ex}\ignorespaces%
  % \vspace{-\baselineskip-\parskip}
\begin{proof}
  1$\Rightarrow$2.
  Let $C\cap\tilde C=\varnothing$ and $\langle a_i\,;b_i\ :\ i<\omega\rangle$ be as given by (1).
  That is, $\tau(a_i\,;b_j)\in C$ and $\tau(a_j\,;b_i)\in \tilde C$ hold for every $i<j<\omega$.
  We can find a subsequence such that the two limits exist; $C$ contains the limit on the left; and $\tilde C$ contains the limit on the right~--~which therefore are distinct.%\ \cup\ \tilde C\times C

  2$\Rightarrow$1. Let $C$ and $\tilde C$ be disjoint neighborhoods of the two limits in (2).
  Then (1) is witnessed by a tail of the sequence $\langle a_i\,;b_i\ :\ i<\omega\rangle$.
\end{proof}


Let $f:{\EuScript U}^{z}\to S$ be a function.
We define
{\def\medrel#1{\parbox{5ex}{\hfil $#1$}}
\def\ceq#1#2#3{\parbox[t]{15ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

\ceq{\hfill{\EuScript D\!}_f}{=}{\big\{\langle b,C\rangle\ \ :\ \ f(b)\in C,\ \ b\in{\EuScript U}^{z},\ \ C\in K(S)\big\}}.}

The following fact is immediate.

\begin{fact}
  The following are equivalent
  \begin{itemize}
    \item [1.] ${\EuScript D\!}_f$ is approximable by $\tau(x\,;z)\in X$
    \item [2.] for every small $B\subseteq{\EuScript U}^z$ there is an $a\in{\EuScript U}^x$ such that $\tau(a\,;b)=f(b)$ for every $b\in B$.\smallskip
  \end{itemize}
\end{fact}

We say that $f$ is \emph{approximable\/} by $\tau(x\,;z)$ if the equivalent conditions above hold.
The following is an easy consequence of Theorem~\ref{thm_stability_definability}.

\def\medrel#1{\parbox{5ex}{\hfil $#1$}}
\def\ceq#1#2#3{\parbox[t]{38ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

\begin{theorem}
  Let $S=[0,1]$.
  Let $\tau(x\,;z)$ be a term and let $f$ be approximable by $\tau(x\,;z)$.\smallskip
  
  1. \ If $\tau(x\,;z)$ is stable, then there are $\lambda$ and $\langle a_{i,j}\ :\ i,j<\lambda\rangle$ such that for every $b\in{\EuScript U}^z$\smallskip

  \ceq{\hfill \sup_{i<\lambda}\ \mathop{\inf\vphantom{p}}_{j<\lambda}\ \tau(a_{i,j}\,;b)}{=}{f(b).}\smallskip

  2.  If $\tau(x\,;z)$ is $\varepsilon$-stable there are $m$ and $\langle a_{i,j}\ :\ i,j<m\rangle$ such that for every $b\in{\EuScript U}^z$\smallskip

  \ceq{\hfill\Big|f(b)\ -\ \max_{i<m}\ \min_{j<m}\ \tau(a_{i,j}\,;b)\Big|}{\le}{\varepsilon.}
\end{theorem}

% Again we do not know if the theorem holds with definable function for terms.

From the proof it is clear that the order of $\sup$ and $\inf$, respectively $\max$ and $\min$, can be reversed.

\begin{proof}
  We prove the first claim.
  Let $\lambda$ and $\langle a_{i,j}\ :\ i,j<\lambda\rangle$ be as in Theorem~\ref{thm_stability_definability}.
  Let $C_i$ be the closure of the set $\{\tau(a_{i,j}\,;b)\,:\,j<\lambda\}$.
  By ($\Leftarrow$) in Theorem~\ref{thm_stability_definability}, $f(b)\in C_i$ for every $i<\lambda$.
  Then $f(b) \ge \inf_j \tau(a_{i,j}\,;b)$ for every $i<\lambda$.
  Therefore $f(b) \ge \sup_i\,\inf_j \tau(a_{i,j}\,;b)$.
 
  Now, by ($\Rightarrow$) in Theorem~\ref{thm_stability_definability} there is $k<\lambda$ such that $f(b) = \tau(a_{k,j}\,;b)$ for every $j<\lambda$.
  Therefore $f(b) = \inf_j \tau(a_{k,j}\,b)$.
  Then $f(b)\le \sup_i\inf_j \tau(a_{i,j}\,b)$.
  
  We prove the second claim.
  Let $m$ and $\langle a_{i,j}\ :\ i,j<m\rangle$ be as in Theorem~\ref{thm_epsilon_stability_definability} (without loss of generality $k=m$).
  Then Theorem~\ref{thm_epsilon_stability_definability} gives

  \ceq{3.\hfill\bigvee_{i< m}\ \bigwedge_{j<m}\ \big|\tau(a_{i,j}\,;b)-f(b)\big|\le\varepsilon.}{ }{}

  We claim that we also have

  \ceq{4.\hfill\bigwedge_{i< m}\ \bigvee_{j<m}\ \big|\tau(a_{i,j}\,;b)-f(b)\big|\ \le\ \varepsilon.}{ }{}

  For $i<m$, let $C_i=\{\tau(a_{i,j}\,;b):j<m\}$.
  Then 

  \ceq{\hfill\bigwedge_{j<m}\ \tau(a_{i,j}\,;b)\in C_i}{ }{},

  hence by Theorem~\ref{thm_epsilon_stability_definability} (2) there is $k$ such that
  
  \ceq{\hfill\big|\tau(a_{i,k}\,;b)-f(b)\big|}{\le}{\varepsilon.}

  Then (4) follows.

  Now, suppose (2) of the theorem fails for the given $\varepsilon$.
  Then for some $b\in{\EuScript U}^z$ one of the following obtains

  \ceq{5.\hfill f(b)\ -\ \min_{j<m}\ \tau(a_{i,j}\,;b)}{>}{\varepsilon}\hfill for every $i<m$\phantom{.}

  \ceq{6.\hfill \min_{j<m}\ \tau(a_{i,j}\,;b)\ -\ f(b)}{>}{\varepsilon}\hfill for some $i<m$.

But (5) contradicts (3), while (6) contradicts (4).
\end{proof}


% \begin{fact}[ (conjecture)]
%   The following are equivalent
%   \begin{itemize}
%     \item [1] ${\EuScript D\!}_f$ is $\delta$-approximable by $\tau(x\,;z)\in X$
%     \item [2] for every small $B\subseteq{\EuScript U}^z$ there is an $a\in{\EuScript U}^x$ such that $\big\langle\tau(a\,;b)\,;f(b)\big\rangle\in\delta$ for every $b\in B$.
%   \end{itemize}
% \end{fact}
