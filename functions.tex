% !TEX root = clcl3.tex
\section{Stable definable functions}
\def\medrel#1{\parbox{5ex}{\hfil $#1$}}
\def\ceq#1#2#3{\parbox[t]{28ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

In this section we specialize the notions introduced in the previous sections to types $\sigma(x\,;z\,;X)$ of the form $\tau(x\,;z)\in X$ where $\tau(x\,;z)$ is an $S$-valued ${\EuScript F}$-type-definable function.

We say that $\tau(x\,;z)$ is \emph{stable\/} if so is the type $\tau(x\,;z)\in X$.
The following fact is an interesting characterization of stability for functions which was first remarked in~\cite{B}.

\begin{fact}\label{fact_grothendieck}
  Let $S$ be a compact metric space.
  Let $\tau(x\,;z)$ be a term in ${\EuScript L}$.
  Then the following are equivalent
  \begin{itemize}
    \item [1.] the formula $\tau(x\,;z)\in X$ is unstable
    \item [2.] there is a sequence $\langle a_i\,;b_i\ :\ i<\omega\rangle$ such that the two limits below exist and\smallskip
    
    \noindent\kern-\labelwidth\kern-\labelsep
    \ceq{\hfill \lim_{i\to\infty}\lim_{j\to\infty}\tau(a_i\,;b_j)}{\neq}{\lim_{j\to\infty}\lim_{i\to\infty}\tau(a_i\,;b_j).}

    % \item [3.] there is a sequence $\langle a_i\,;b_i\ :\ i<\omega\rangle$ and some $\varepsilon$ such that for every $i<j<\omega$\smallskip
    
    % \noindent\kern-\labelwidth\kern-\labelsep
    % \ceq{\hfill\big\langle\tau(a_i\,;b_j),\ \tau(a_j\,;b_i)\big\rangle}{\notin}{\varepsilon.}

    % \item [3.] for some sequence $\langle a_i\,;b_i\ :\ i<\omega\rangle$ and some neighborhood $\varepsilon$ of the diagonal of $S^2$\smallskip

    % \ceq{\hfill \big\langle\tau(a_i\,;b_j),\ \tau(a_j\,;b_i)\big\rangle}{\notin}{\varepsilon}\smallskip

    % for every $i<j<\omega$.
  \end{itemize}
\end{fact}  
  Terms are a specific kind of definable functions.
  When $\tau(x\,;z)$ is a term, we have that ${\sim}\big(\tau(x\,;z)\in X\big)=\tau(x\,;z)\in X$, which is used throughout the proof below.
  We suspect that Fact~\ref{fact_grothendieck} holds for $\tau(x\,;z)$ any $S$-valued ${\EuScript F}$-type-definable function but we have not been able to prove this.

  % \noindent\llap{\textcolor{red}{\Large\warning}\kern1.5ex}\ignorespaces%
  % \vspace{-\baselineskip-\parskip}
\begin{proof}
  %2$\Leftrightarrow$3 Clear.
  %
  1$\Rightarrow$2.
  Let $C\cap\tilde C=\varnothing$ and $\langle a_i\,;b_i\ :\ i<\omega\rangle$ be as given by (1).
  That is, $\tau(a_i\,;b_j)\in C$ and $\tau(a_j\,;b_i)\in \tilde C$ hold for every $i<j<\omega$.
  We can find a subsequence such that the two limits exist; $C$ contains the limit on the left; and $\tilde C$ contains the limit on the right~--~which therefore are distinct.%\ \cup\ \tilde C\times C

  2$\Rightarrow$1. Let $C$ and $\tilde C$ be disjoint neighborhoods of the two limits in (2).
  Then (1) is witnessed by a tail of the sequence $\langle a_i\,;b_i\ :\ i<\omega\rangle$.
\end{proof}

% Let ${\EuScript D}\subseteq{\EuScript U}^{z}\times K(S)$.

Let $f:{\EuScript U}^{z}\to S$ be a function.
We define
{\def\medrel#1{\parbox{5ex}{\hfil $#1$}}
\def\ceq#1#2#3{\parbox[t]{15ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

\ceq{\hfill{\EuScript D\!}_f}{=}{\big\{\langle b,C\rangle\ \ :\ \ f(b)\in C,\ \ b\in{\EuScript U}^{z},\ \ C\in K(S)\big\}}.}

% Note that ${\sim}{\EuScript D\!}_f={\EuScript D\!}_f$ therefore, by Fact~\ref{fact_~definibile} and~\ref{fact_~inclusione} the implications in Definition~\ref{def_approx_X} are in fact equivalences.

The following fact is immediate.

\begin{fact}
  The following are equivalent
  \begin{itemize}
    \item [1.] ${\EuScript D\!}_f$ is approximable by $\tau(x\,;z)\in X$
    \item [2.] for every small $B\subseteq{\EuScript U}^z$ there is an $a\in{\EuScript U}^x$ such that $\tau(a\,;b)=f(b)$ for every $b\in B$.\smallskip
  \end{itemize}
\end{fact}

We say that $f$ is approximable by $\tau(x\,;z)$ if the equivalent conditions above hold.
The following is an easy consequence of Theorem~\ref{thm_stability_definability}.

\begin{theorem}
  Let $S=[0,1]$.
  Let $\tau(x\,;z)$ be stable.
  Let $f$ be approximable by $\tau(x\,;z)$.
  Then there are some $\langle a_{i,j}\ :\ i,j<\lambda\rangle$ such that for every $b\in{\EuScript U}^z$\smallskip

  \ceq{1.\hfill f(b)}{=}{\sup_{i<\lambda}\ \mathop{\inf\vphantom{p}}_{j<\lambda}\ \tau(a_{i,j}\,;b).}
  
\end{theorem}

\begin{proof}[Half proof]
  From Theorem~\ref{thm_stability_definability} we obtain that for every $b\in{\EuScript U}^z$ \medskip

  \ceq{2.\hfill f(b)\in C}{\Leftrightarrow}{\bigvee_{i<\lambda}\ \bigwedge_{j<\lambda}\ \tau(a_{i,j}\,;b)\in C}\hfill for every $C$

  We claim that (2) is equivalent to
  
  \ceq{3.\hfill f(b)\in C}{\Leftrightarrow}{\bigwedge_{i<\lambda}\ \bigvee_{j<\lambda}\ \tau(a_{i,j}\,;b)\in C}\hfill for every $C$
  
  Assume (3) and that (2) fails for some $C$.
  Without loss of generality

  \ceq{\hfill f(b)\in C}{\&}{\neg\bigvee_{i<\lambda}\ \bigwedge_{j<\lambda}\ \tau(a_{i,j}\,;b)\in C}

  Then for some $\tilde C\cap C=\varnothing$ 

  \ceq{}{ }{\bigwedge_{i<\lambda}\ \bigvee_{j<\lambda}\ \tau(a_{i,j}\,;b)\in \tilde C}

  By (3) we obtain a contradiction.
  Then (3) implies (2).
  The same argument proves the converse implication.

  Now negate (1).
  Then for some $b\in{\EuScript U}^z$ and some $\varepsilon>0$ one of the following obtains
  
  \ceq{4.\hfill f(b)-\varepsilon}{>}{\inf_{j<\lambda}\ \tau(a_{i,j}\,;b)}\hfill for every $i<\lambda$.

  \ceq{5.\hfill f(b)-\varepsilon}{<}{\inf_{j<\lambda}\ \tau(a_{i,j}\,;b)}\hfill for some $i<\lambda$.


Assuming (4), we contradict (2) with $C=[f(b)-\varepsilon/2,\ 1]$.
On the other hand, if (5) we contradict (3) with $C=[0,\ f(b)+\varepsilon/2]$.
\end{proof}


% \begin{fact}[ (conjecture)]
%   The following are equivalent
%   \begin{itemize}
%     \item [1] ${\EuScript D\!}_f$ is $\delta$-approximable by $\tau(x\,;z)\in X$
%     \item [2] for every small $B\subseteq{\EuScript U}^z$ there is an $a\in{\EuScript U}^x$ such that $\big\langle\tau(a\,;b)\,;f(b)\big\rangle\in\delta$ for every $b\in B$.
%   \end{itemize}
% \end{fact}
