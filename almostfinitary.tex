% !TEX root = clcl3.tex
\section{Yet another version of stability}
\def\medrel#1{\parbox{5ex}{\hfil $#1$}}
\def\ceq#1#2#3{\parbox[t]{28ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

In this section we present the notion of $\varepsilon$-stability and prove a version of Theorem~\ref{thm_stability_definability} which, albeit approximate,  only requires finite disjunctions and conjunctions.
Note that the requirement of $\varepsilon$-stability is stronger the smaller the $\varepsilon$ and it always implies stability as defined in Defintion~\ref{def_stable}~--~we do not know whether the two notions coincide in the limit.

\begin{definition}\label{def_epsilon_stable}\strut
  We say that $\varphi(x\,;z\,;X)$ is \emph{$\varepsilon$-stable\/} if there is a greatest $m$ for which there is some sequence $\langle a_i\,;b_i\,;C_i\,;\tilde C_i\ :\ i<m\rangle$ such that for every $i<n<m$

    \ceq{\hfill \varphi(a_n\,;b_i\,;C_i)}{\wedge}{{\sim}\varphi(a_i\,;b_n\,;\tilde C_n)}\quad and\quad $C_i^\varepsilon\cap\tilde C_i=\varnothing$.\smallskip
\end{definition}

% We remark that, by Facts~\ref{fact_~definibile} and~\ref{fact_~inclusione}, when ${\EuScript D}$ is involutive 
% %(1) can be rephrased as
% %
% % \ceq{\hfill{\sim}\varphi(a\,;b\,;C)}{\Rightarrow}{\langle b,C\rangle\in{\sim}{\EuScript D}}\hfill for every $b\in B$ and every $C$.
% %
% % Analogously, 
% (2) can be rephrased as

% \ceq{\hfill \langle b,C\rangle\in{\sim}{\EuScript D}_\varepsilon}{\Rightarrow}{{\sim}\varphi(a\,;b\,;C)}\hfill for every $b\in B$ and every $C$,

% where ${\EuScript D}_\varepsilon=\big\{C^\varepsilon\ :\ C\in{\EuScript D}\big\}$.

% \begin{fact}
%   For every involutive ${\EuScript D}$ the following are equivalent
%   \begin{itemize}
%     \item [1.] ${\EuScript D}$ is approximable
%     \item [2.] ${\EuScript D}$ is $\varepsilon$-approximable by $\varphi(x\,;z\,;X)$ for every $\varepsilon$
    
%   \end{itemize}
% \end{fact}

% \begin{proof}
%   Immediate.
% \end{proof}

We state the main theorem of this section which is proved along the same lines as Theorem~\ref{thm_stability_definability}.

\begin{theorem}\label{thm_epsilon_stability_definability}
  Let $\varphi(x\,;z\,;X)$ be $\varepsilon$-stable.
  Assume that ${\EuScript D}$ is approximable by $\varphi(x\,;z\,;X)$.
  Then there are some $\langle a_{i,j}\ :\ i< k,\ j<m\rangle$ such that for every $b\in{\EuScript U}^z$ and every $C$\medskip

  \ceq{\hfill \langle b,C\rangle\in{\EuScript D}}{\Rightarrow}{\bigvee_{i< k}\ \bigwedge_{j<m}\ \varphi(a_{i,j}\,;b\,;C^\varepsilon)}\medskip

  \ceq{\hfill \langle b,C^\varepsilon\rangle\in{\EuScript D}}{\Leftarrow}{\bigvee_{i< k}\ \bigwedge_{j<m}\ \varphi(a_{i,j}\,;b\,;C)}
\end{theorem}

\begin{proof}
  The theorem is an immediate consequence of the following three lemmas.
\end{proof}


The proof of the theorem requires the following version of Definition~\ref{def_approx_blw}

\begin{definition}\label{def_e_approx_blw}\strut
  We say that ${\EuScript D}$ is \emph{approximable\/} by $\varphi(x\,;z\,;X)$ \emph{from $\varepsilon$-below\/} if for every finite $B\subseteq{\EuScript U}^z$ there is an $a\in{\EuScript U}^x$ such that for every $C$\smallskip

  \ceq{1.\hfill \langle b,C\rangle\in{\EuScript D}}{\Rightarrow}{\varphi(a\,;b\,;C)}\hfill for every $b\in B$ and\smallskip

  \ceq{2.\hfill\langle b,C^\varepsilon\rangle\in {\EuScript D}}{\Leftarrow}{\varphi(a\,;b\,;C)}\hfill for every $b\in{\EuScript U}^z$.\smallskip
\end{definition}


\begin{lemma}
  Let $\varphi(x\,;z\,;X)$ be $\varepsilon$-stable.
  Assume that ${\EuScript D}$ is approximable by $\varphi(x\,;z\,;X)$ from $\varepsilon$-below.
  Then there is some $\langle a_i\ :\ i<k\rangle$ such that for every $b\in{\EuScript U}^z$ and every $C$\medskip

  \ceq{1.\hfill \langle b,C\rangle\in{\EuScript D}}{\Rightarrow}{\bigvee_{i<k}\ \varphi(a_i\,;b\,;C^\varepsilon)}\medskip 

  \ceq{2.\hfill \langle b,C^\varepsilon\rangle\in{\EuScript D}}{\Leftarrow}{\bigvee_{i<k}\ \varphi(a_i\,;b\,;C)} 
\end{lemma}

\begin{proof}
  We define recursively the required parameters $a_i$ together with some auxiliary parameters $b_i$.
  The element $a_n$ is choosen such that

\ceq{3.\hfill \langle b,C^\varepsilon\rangle\in{\EuScript D}}{\Leftarrow}{\varphi(a_n\,;b\,;C)}\hfill for every $b\in{\EuScript U}^z$ and every $C$

and

\ceq{4.\hfill \langle b_i,C\rangle\in{\EuScript D}}{\Rightarrow}{\varphi(a_n\,;b_i\,;C)}\hfill for every $i<n$ and every $C$.\smallskip

This is possible because ${\EuScript D}$ is $\varepsilon$-approximated from below.
Note that (3) immediately guarantees (2).
Now, assume (1) fails for $k=n$, and choose $b_n$ and $C_n$ witnessing this.
Then, by Fact~\ref{fact_otto}, for some $\tilde C_n\cap C_n^\varepsilon=\varnothing$

\ceq{5.\hfill \langle b_n,C_n\rangle\in{\EuScript D}}{\&}{\bigwedge_{i<n}\ {\sim}\varphi(a_i\,;b_n\,;\tilde C_n)}%\smallskip

Suppose for a contradiction that the construction never ends.
Then, as (5) guarantees that $\langle b_i,C_i\rangle\in{\EuScript D}$ for every $i$, from (4) we otain $\varphi(a_n\,;b_i\,;C_n)$ for every $i<n$.
From (5) we also obtain ${\sim}\varphi(a_i\,;b_n\,;\tilde C_n)$, for every $i\le n$.
This contradicts $\varepsilon$-stability.
\end{proof}

\begin{lemma}
  Let $\varphi(x\,;z\,;X)$ be $\varepsilon$-stable.
  Assume that ${\EuScript D}$ is approximable by $\varphi(x\,;z\,;X)$.
  Let $m$ be maximal so that a sequence as in (3) of Definition~\ref{def_epsilon_stable} exists.
  Let $\bar x=\langle x_i\ :\ i\le m\rangle$ where the $x_i$ are copies of $x$.
  Then the formula\smallskip

  \ceq{\hfill\sigma(\bar x\,;z\,;X)}{=}{\bigwedge_{i\le m}\ \varphi(x_i\,;z\,;X)}\smallskip

  approximate ${\EuScript D}$ from $\varepsilon$-below.
\end{lemma}

\begin{proof}
  Negate the claim and let $B$ witness that $\sigma(\bar x)$ does not approximate ${\EuScript D}$ from $\varepsilon$-below.
  Suppose that $a_0,\dots,a_{n-1}$ and $b_0,\dots,b_{n-1}$ have been defined.
  Choose $a_n$ such that for every $b\in B\cup\{b_0,\dots,b_{n-1}\}$ and every $C$

  \ceq{1.\hfill\langle b,C\rangle\in{\EuScript D}}{\Rightarrow}{\varphi(a_n\,;b\,;C)}\quad and

  \ceq{2.\hfill\langle b,C^\varepsilon\rangle\in{\EuScript D}}{\Leftarrow}{\varphi(a_n\,;b\,;C^\varepsilon)}
  
  Note that the latter implication is equivalent to: for every $C$ there is some  $\tilde C\cap C^\varepsilon=\varnothing$ such that 
  
  \ceq{3.\hfill \langle b,C^\varepsilon\rangle\notin{\EuScript D}}{\Rightarrow}{{\sim}\varphi(a_n\,;b\,;\tilde C)}.%\hfill  for every $b\in B\cup\{b_0,\dots,b_{n-1}\}$.

  Now, as the lemma is assumed to fail, we can choose $b_n$ and $C_n$ such that

  \ceq{4.\hfill \langle b_n,C_n^\varepsilon\rangle\notin{\EuScript D}}{\&}{\bigwedge_{i=0}^n\ \varphi(a_i\,;b_n\,;C_n)}

  Note that (4) ensure that $\langle b_i,C_i^\varepsilon\rangle\notin{\EuScript D}$ for every $i$.
  The there is some $\tilde C_i$ that witnesses (3) for $\langle b_i,C_i^\varepsilon\rangle\notin{\EuScript D}$.
  We claim that the procedure has to stop after $\le m$ steps. 
  In fact, from (3) we obtain ${\sim}\varphi(a_n\,;b_i\,;\tilde C_i)$ for every $i<n$.
  On the other hand, by (4) we have that $\varphi(a_i\,;b_n\,;C_n)$ for every $i<n$.
  Therefore, $\langle a_{m-i}\,;b_{m-i}\,;C_{m-i}\,;\tilde C_{m-i}\ :\ i\le m\rangle$ contradicts the maximality of $m$.
\end{proof}

\begin{lemma}\label{lem_sigma_stable}
  If $\varphi(x\,;z\,;C)$ is $\varepsilon$-stable then $\sigma(\bar x\,;z\,;C)$ in the previous lemma is $\varepsilon$-stable.
\end{lemma}

\begin{proof}
  Let $m$ be maximal such that a sequence as in (3) of Definition~\ref{def_epsilon_stable} exists.
  Let $k$ be suffinciently large so that every $m$-coloring of a graph of size $k$ has a monocromatic subgraph of size $>m$.
  Let $\langle \bar a_i\,;b_i\,;C_i\,;\tilde C_i\ :\ i<k\rangle$ be a sequence witnessing instability.
  Then for every pair $i<n$ there is some $j<m$ such that ${\sim}\varphi(a_{j,n}\,;b_i\,;\tilde C_i)$.
  By the choice of $k$ there is a $j<m$ such that ${\sim}\varphi(a_{j,n}\,;b_i\,;\tilde C_i)$ obtains for $>m$ many $i$.
  Therefore we can extract a subsequence that contradicts the maximality of $m$.
\end{proof}
