% !TEX root = clcl3.tex
\section{Yet another version of stability}
\def\medrel#1{\parbox{5ex}{\hfil $#1$}}
\def\ceq#1#2#3{\parbox[t]{28ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

In this section we present the notion of $\varepsilon$-stability and prove a version of Theorem~\ref{thm_stability_definability} which, albeit approximate,  only requires finite disjunctions and conjunctions.

In this section, the letter $\varepsilon$ always denotes a compact symmetric neighborhood of the diagonal of $S^2$.
% By $\varepsilon+\delta$ we denote the composition $\varepsilon\circ\varepsilon$, where the two sets are viewed as relations.
If $C$ is a subset of $S$, we write $C^\varepsilon$ for the set of points that are $\varepsilon$-close to points in $C$.
That is

\ceq{\hfill C^\varepsilon}{=}{\big\{\alpha\in S\ :\ \langle\xi,\alpha\rangle\in \varepsilon\ \text{ for some }\ \xi\in C\big\}.}

When $C$ is a tuple, the definition above applies componentwise.

\begin{definition}\label{def_epsilon_stable}\strut
  Let $\varphi(x\,;z\,;X)$, for $x$ and $z$ tuples of variables of sort ${\sf H}$, be an ${\EuScript F}_{\sf X}$-for\-mu\-la.
  We say that $\varphi(x\,;z\,;X)$ is \emph{$\varepsilon$-unstable\/} if for every $m<\omega$ there is a sequence $\langle a_i\,;b_i\,;C_i\,;\tilde C_i\ :\ i<m\rangle$ such that for every $i<n<m$\smallskip

    \ceq{\hfill \varphi(a_n\,;b_i\,;C_i)}{\wedge}{{\sim}\varphi(a_i\,;b_n\,;\tilde C_n)}\quad and\quad $C_i^\varepsilon\cap\tilde C_i=\varnothing$.\smallskip

  A formula is \emph{$\varepsilon$-stable\/} if it not not $\varepsilon$-unstable.  
\end{definition}

Note that the requirement of $\varepsilon$-stability is stronger the smaller the $\varepsilon$.
If we replace $\varepsilon$ with the diagonal of $S^2$, it is not difficult to see (by compactness and using that $\kappa$ is a Ramsey cardinal) that we obtain a condition equivalent to stability as in Definition~\ref{def_stable}.
However, we do not know if a formula that is $\varepsilon$-stable for all nontrivial $\varepsilon$ is also stable.

% We remark that, by Facts~\ref{fact_~definibile} and~\ref{fact_~inclusione}, when ${\EuScript D}$ is involutive 
% %(1) can be rephrased as
% %
% % \ceq{\hfill{\sim}\varphi(a\,;b\,;C)}{\Rightarrow}{\langle b,C\rangle\in{\sim}{\EuScript D}}\hfill for every $b\in B$ and every $C$.
% %
% % Analogously, 
% (2) can be rephrased as

% \ceq{\hfill \langle b,C\rangle\in{\sim}{\EuScript D}_\varepsilon}{\Rightarrow}{{\sim}\varphi(a\,;b\,;C)}\hfill for every $b\in B$ and every $C$,

% where ${\EuScript D}_\varepsilon=\big\{C^\varepsilon\ :\ C\in{\EuScript D}\big\}$.

% \begin{fact}
%   For every involutive ${\EuScript D}$ the following are equivalent
%   \begin{itemize}
%     \item [1.] ${\EuScript D}$ is approximable
%     \item [2.] ${\EuScript D}$ is $\varepsilon$-approximable by $\varphi(x\,;z\,;X)$ for every $\varepsilon$
    
%   \end{itemize}
% \end{fact}

% \begin{proof}
%   Immediate.
% \end{proof}

We state the main theorem of this section, which is proved along the same lines as Theorem~\ref{thm_stability_definability}.

\begin{theorem}\label{thm_epsilon_stability_definability}
  Let $\varphi(x\,;z\,;X)$ be $\varepsilon$-stable.
  Assume that ${\EuScript D}$ is approximable by $\varphi(x\,;z\,;X)$.
  Then there are $k,m<\omega$ and $\langle a_{i,j}\ :\ i< k,\ j<m\rangle$ such that for every $b\in{\EuScript U}^z$ and every $C$\medskip

  \ceq{1.\hfill \langle b,C\rangle\in{\EuScript D}}{\Rightarrow}{\bigvee_{i< k}\ \bigwedge_{j<m}\ \varphi(a_{i,j}\,;b\,;C^\varepsilon)}\medskip

  \ceq{2.\hfill \langle b,C^\varepsilon\rangle\in{\EuScript D}}{\Leftarrow}{\bigvee_{i< k}\ \bigwedge_{j<m}\ \varphi(a_{i,j}\,;b\,;C).}
\end{theorem}

\begin{proof}
  The theorem is an immediate consequence of the following three lemmas.
\end{proof}

We need the following version of Definition~\ref{def_approx_blw}.

\begin{definition}\label{def_e_approx_blw}\strut
  We say that ${\EuScript D}$ is \emph{approximable\/} by $\varphi(x\,;z\,;X)$ \emph{from $\varepsilon$-below\/} if for every finite $B\subseteq{\EuScript U}^z$ there is an $a\in{\EuScript U}^x$ such that for every $C$\smallskip

  \ceq{1.\hfill \langle b,C\rangle\in{\EuScript D}}{\Rightarrow}{\varphi(a\,;b\,;C)}\hfill for every $b\in B$ and\smallskip

  \ceq{2.\hfill\langle b,C^\varepsilon\rangle\in {\EuScript D}}{\Leftarrow}{\varphi(a\,;b\,;C)}\hfill for every $b\in{\EuScript U}^z$.\smallskip
\end{definition}


\begin{lemma}
  Let $\varphi(x\,;z\,;X)$ be $\varepsilon$-stable.
  Assume that ${\EuScript D}$ is approximable by $\varphi(x\,;z\,;X)$ from $\varepsilon$-below.
  Then there are $k<\omega$ and $\langle a_i\ :\ i<k\rangle$ such that for every $b\in{\EuScript U}^z$ and every $C$\medskip

  \ceq{1.\hfill \langle b,C\rangle\in{\EuScript D}}{\Rightarrow}{\bigvee_{i<k}\ \varphi(a_i\,;b\,;C^\varepsilon)}\medskip 

  \ceq{2.\hfill \langle b,C^\varepsilon\rangle\in{\EuScript D}}{\Leftarrow}{\bigvee_{i<k}\ \varphi(a_i\,;b\,;C).} 
\end{lemma}

The proof is entirely similar to that of Lemma~\ref{lem_1_inf}.
It is nevertheless included to show the role of $C^\varepsilon$.

\begin{proof}
  We define recursively the required parameters $a_i$ together with some auxiliary parameters $b_i$.
  The element $a_n$ is chosen so that

\ceq{3.\hfill \langle b,C^\varepsilon\rangle\in{\EuScript D}}{\Leftarrow}{\varphi(a_n\,;b\,;C)}\hfill for every $b\in{\EuScript U}^z$ and every $C$

and

\ceq{4.\hfill \langle b_i,C\rangle\in{\EuScript D}}{\Rightarrow}{\varphi(a_n\,;b_i\,;C)}\hfill for every $i<n$ and every $C$.\smallskip

This is possible because ${\EuScript D}$ is approximated from $\varepsilon$-below.
Note that (3) immediately guarantees (2).
Now, assume (1) fails for $k=n+1$, and choose $b_n$ and $C_n$ witnessing this.
Then, by Fact~\ref{fact_otto}, for some $\tilde C_{i,n}\cap C_n^\varepsilon=\varnothing$

\ceq{5.\hfill \langle b_n,C_n\rangle\in{\EuScript D}\ \ }{\text{and}}{\ \ \bigwedge_{i\le n}\ {\sim}\varphi(a_i\,;b_n\,;\tilde C_{i,n}).}%\smallskip

Let $m$ witness the $\varepsilon$-stability of $\varphi(x\,;z\,;X)$.
Suppose for a contradiction that the construction carries on for $m$ stages.
Then, as (5) guarantees that $\langle b_i,C_i\rangle\in{\EuScript D}$ for every $i$, from (4) we obtain $\varphi(a_n\,;b_i\,;C_i)$ for every $i<n<m$.
From (5) we also obtain, for every $i< n<m$, some $\tilde C_{i,n}\cap C_n^\varepsilon=\varnothing$ such that ${\sim}\varphi(a_i\,;b_n\,;\tilde C_{i,n})$.
By monotonicity, ${\sim}\varphi(a_i\,;b_n\,;\tilde C_n)$ for $\tilde C_n=\bigcup_{i< m}\tilde C_{i,n}$.
This contradicts our choice of $m$.
\end{proof}

\begin{lemma}
  Let $\varphi(x\,;z\,;X)$ be $\varepsilon$-stable.
  Assume that ${\EuScript D}$ is approximable by $\varphi(x\,;z\,;X)$.
  Let $m$ witness the $\varepsilon$-stability of  $\varphi(x\,;z\,;X)$, see Definition~\ref{def_epsilon_stable}.
  Let $\bar x=\langle x_i\ :\ i\le m\rangle$ where the $x_i$ are copies of $x$.
  Then the formula\smallskip

  \ceq{\hfill\sigma(\bar x\,;z\,;X)}{=}{\bigwedge_{i\le m}\ \varphi(x_i\,;z\,;X)}\smallskip

  approximates ${\EuScript D}$ from $\varepsilon$-below.
\end{lemma}

\begin{proof}
  Negate the claim and let $B$ witness that $\sigma(\bar x)$ does not approximate ${\EuScript D}$ from $\varepsilon$-below.
  Suppose that $a_0,\dots,a_{n-1}$ and $b_0,\dots,b_{n-1}$ have been defined.
  Choose $a_n$ such that for every $b\in B\cup\{b_0,\dots,b_{n-1}\}$ and every $C$

  \ceq{1.\hfill\langle b,C\rangle\in{\EuScript D}}{\Rightarrow}{\varphi(a_n\,;b\,;C)}\quad and

  \ceq{2.\hfill\langle b,C^\varepsilon\rangle\in{\EuScript D}}{\Leftarrow}{\varphi(a_n\,;b\,;C^\varepsilon).}
  
  Note that the second implication is equivalent to: for every $C$ there is some  $\tilde C\cap C^\varepsilon=\varnothing$ such that 
  
  \ceq{3.\hfill \langle b,C^\varepsilon\rangle\notin{\EuScript D}}{\Rightarrow}{{\sim}\varphi(a_n\,;b\,;\tilde C)}.%\hfill  for every $b\in B\cup\{b_0,\dots,b_{n-1}\}$.

  Now, as the lemma is assumed to fail, we can choose $b_n$ and $C_n$ such that

  \ceq{4.\hfill \langle b_n,C_n^\varepsilon\rangle\notin{\EuScript D}\ \ }{\text{and}}{\ \ \bigwedge_{i=0}^n\ \varphi(a_i\,;b_n\,;C_n).}

  Note that (4) ensures that $\langle b_i,C_i^\varepsilon\rangle\notin{\EuScript D}$ for every $i$.
  Then there is some $\tilde C_{i,n}\cap C^\varepsilon_i=\varnothing$ that witnesses (3) for $\langle b_i,C_i^\varepsilon\rangle\notin{\EuScript D}$.
  We claim that the procedure has to stop after $< m$ steps. 
  In fact, from (3) we obtain ${\sim}\varphi(a_n\,;b_i\,;\tilde C_{i,n})$ for every $i<n<m$.
  Therefore, by monotonicity, ${\sim}\varphi(a_n\,;b_i\,;\tilde C_i)$ for $\tilde C_i=\bigcup_{n< m}\tilde C_{i,n}$.
  On the other hand, by (4) we have that $\varphi(a_i\,;b_n\,;C_n)$ for every $i<n<m$.
  Therefore, $\langle a_{m-1-i}\,;b_{m-1-i}\,;C_{m-1-i}\,;\tilde C_{m-1-i}\ :\ i< m\rangle$ contradicts the choice of $m$.
\end{proof}

\begin{lemma}\label{lem_sigma_stable}
  If $\varphi(x\,;z\,;C)$ is $\varepsilon$-stable then $\sigma(\bar x\,;z\,;C)$ in the previous lemma is $\varepsilon$-stable.
\end{lemma}

\begin{proof}
  Let $m$ be maximal such that a sequence as in (3) of Definition~\ref{def_epsilon_stable} exists.
  Let $k$ be sufficiently large so that every $m$-coloring of a graph of size $k$ has a monocromatic subgraph of size $>m$.
  Let $\langle \bar a_i\,;b_i\,;C_i\,;\tilde C_i\ :\ i<k\rangle$ be a sequence witnessing the $\varepsilon$-instability.
  Then for every pair $i<n$ there is some $j<m$ such that ${\sim}\varphi(a_{j,i}\,;b_n\,;\tilde C_i)$.
  By the choice of $k$ there is a $j<m$ such that ${\sim}\varphi(a_{j,i}\,;b_n\,;\tilde C_i)$ obtains for $>m$ many $i$.
  Therefore we can extract a subsequence that contradicts the maximality of $m$.
\end{proof}
